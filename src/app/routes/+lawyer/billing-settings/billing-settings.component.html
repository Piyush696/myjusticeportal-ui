<div class="pl-3">
    <h1 class="font-weight-bold m-0">Manage Billing Settings</h1>
    <h4 class="line-height header-sub-text">
        If you need any help, please contact Support. 
    </h4>
</div>
<div class="dflex pb-2">
    <div class="col-12">
                <mat-card class="mat-elevation-z10 border-card card-color">
                    <div class="text-center">
                        <span class="h5 text-center font-weight-bold">Plan Selected</span>
                      </div>
                      <div *ngIf="facilities[0]?.planSelected == 'Up to 5 Connections'" class="row">
                        <div class="col-12 pt-2">
                          <mat-card class="mat-elevation-z10 border-card">
                            <input class="circle"  type="radio" name="package" checked="true">
                              Up to 5 Connections, $250/mo<br/>
                          </mat-card>
                        </div>
                      </div>
      
                      <div *ngIf="facilities[0]?.planSelected == 'Up to 25 Connections'" class="row">
                        <div class="col-12 pt-2">
                          <mat-card class="mat-elevation-z10 border-card">
                            <input class="circle"  type="radio" name="package" checked="true">
                              Up to 25 Connections, $350/mo
                          </mat-card>
                        </div>
                      </div>
      
                      <div *ngIf="facilities[0]?.planSelected == 'Unlimited Connections'" class="row">
                        <div class="col-12 pt-2">
                          <mat-card class="mat-elevation-z10 border-card">
                            <input class="circle"  type="radio" name="package" checked="true">
                              Unlimited Connections, $400/mo
                          </mat-card>
                        </div>
                      </div>
                  </mat-card>
    </div>
</div>
<div class="d-flex">
<div class="col-6">
    <mat-card class="card-color">
        <div class="col-12 pt-2 px-2">
            <div>
                <span class="h5 text-center font-weight-bold">Facilities you have selected</span>
              </div>
            <div class="d-flex justify-content-center align-items-center mt-10;">
                <div class="col-12 pt-2">
                  <div *ngIf="facilities.length == 0">
                    <span>We currently do not have any facilities in your state. Please contact support for more information.</span>
                  </div>
                  <div  *ngIf="facilities.length > 0">
                    
                    <li *ngFor="let facility of facilities;">
                      <mat-checkbox color="primary"  [checked]="facility.isSelected">
                        {{facility?.facilityName}} ({{facility.facilityUserCount}})
                      </mat-checkbox>
                      <div *ngIf="facility.isPremium || facility.isSponsors">
                        <mat-card class="border-card mb-2">
                          <h4 class="font-weight-bold text-center  mb-1 pt-0">Selected Sponsorship Options for this Facility
                          </h4>
                          <div>
                            <mat-checkbox color="primary" [checked]="facility.isPremium">
                              <span>Premium Listing: $0.25/mo./Average Daily Population</span>
                            </mat-checkbox>
                          </div>
                          <div>
                            <mat-checkbox color="primary" [checked]="facility.isSponsors">
                              <span>Sponsorship: $1.00/mo./Average Daily Population</span>
                            </mat-checkbox>
                          </div>
                        </mat-card>
                      </div>
                    </li>
                  </div>
                </div>
            </div>
          </div>
    </mat-card>
</div>
<div class="col-6">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <!-- Estimated Monthly Bill  -->
            <div class="col-12 pt-2">
              <div class="d-flex justify-content-center align-items-center mt-10;">
                <mat-card class="card-color">
                  <div class="col-12 pt-2">
                    <div>
                      <span class="h5 text-center font-weight-bold">Review Plan Details</span>
                    </div>
                    <span class="text-center text-black">Based on the facilities and add ons that you have selected, please
                      review your current monthly bill below.</span>
                    <mat-card class="mat-elevation-z10">
                      <div class="d-flex justify-content-between align-items-between">
                        <div>Plan Base Cost:</div>
                        <div>{{currentPlanPrice | currency:'USD':'symbol'}}</div>
                      </div>
                      <div class="d-flex justify-content-between align-items-between">
                        <div>Add On charges:</div>
                        <div>{{(addOnsBillingPrice  ? addOnsBillingPrice   : 0 ) | currency:'USD':'symbol'}}
                        </div>
                      </div>
                      <hr>
                      <div class="d-flex justify-content-between align-items-between">
                        <div>Total Monthly Charge:</div>
                        <div>
                          <span class="font-weight-bold">Total: </span> {{totalBillingPrice | currency:'USD':'symbol'}}
                        </div>
                      </div>
                    </mat-card>
                  </div>
                </mat-card>
              </div>
            </div>
          </div>   
          <div class="d-flex justify-content-end align-items-end mr-4 pr-2 pt-2">
            <div>
              <button mat-raised-button class="button-purple px-4 py-1 mt-1" (click)="openModal(changePlan)">Change Plan</button>
            </div>
        </div>
</div>
</div>

<ng-template #changePlan>
  <h2 class="text-center">Update Plan</h2>
  <div class="row pb-3">
    <div class="col-12 pr-0">
      <mat-card>
        <div>
          <span class="h5 text-center font-weight-bold">Step 1:</span>&nbsp;
          <span class="h5 text-center font-weight-bold">Select Subscription Level</span>
        </div>
        <h4>How many inmate connections do you need? <a href='https://google.com' target="_blank">Learn More about Connections.</a></h4>
        <div class="row">
          <div class="col-12 pt-2">
            <mat-card class="mat-elevation-z10 border-card">
              <input class="circle"  type="radio" name="package"
                (change)="onSelectPlan('250',$event.checked)">
                Up to 5 Connections, $250/mo<br/>
            </mat-card>
          </div>
        </div>

        <div class="row">
          <div class="col-12 pt-2">
            <mat-card class="mat-elevation-z10 border-card">
              <input class="circle"  type="radio" name="package"
                (change)="onSelectPlan('350',$event.checked)">
                Up to 25 Connections, $350/mo
            </mat-card>
          </div>
        </div>

        <div class="row">
          <div class="col-12 pt-2">
            <mat-card class="mat-elevation-z10 border-card">
              <input class="circle"  type="radio" name="package"
                (change)="onSelectPlan('400',$event.checked)">
                Unlimited Connections, $400/mo
            </mat-card>
          </div>
        </div>
      </mat-card>
  </div>
  </div>
      <div  class="row">
        <div class="col-6">
          <div class="d-flex justify-content-center align-items-center mt-10;">
            <mat-card>
              <div>
                <span class="h5 text-center font-weight-bold">Step 2:</span>&nbsp;
                <span class="h5 text-center font-weight-bold">Select Facilities</span>
              </div>
              <h4>Which facilities would you like to have access? <a href='https://google.com' target="_blank">Learn more about Premium Listings and Sponsorships.</a></h4>
              
              <div class="col-12 pt-2">
                <div *ngIf="facilityList.length < 0">
                  <span>We currently do not have any facilities in your state. Please contact support for more information.</span>
                </div>
                <div  *ngIf="facilityList.length > 0">
                  <li *ngFor="let facility of facilityList;">
                    <mat-checkbox color="primary"
                      (change)="onFacilitySelect($event.checked,facility?.facilityId,facility.facilityUserCount)">
                      {{facility?.facilityName}} ({{facility.facilityUserCount}})
                    </mat-checkbox>
                    <div *ngIf="facility.isSelected">
                      <mat-card class="border-card mb-2">
                        <h4 class="font-weight-bold text-center  mb-1 pt-0">Select Sponsorship Options for this Facility
                        </h4>
                        <div>
                          <mat-checkbox color="primary" [(ngModel)]="facility.addOns.premium"
                            (change)="onSelectAddOns($event.checked,facility?.facilityId,'premium')">
                            <span>Premium Listing: $0.25/mo./Average Daily Population</span>
                          </mat-checkbox>
                        </div>
                        <div>
                          <mat-checkbox color="primary" [(ngModel)]="facility.addOns.sponsors"
                            (change)="onSelectAddOns($event.checked,facility?.facilityId,'sponsors')">
                            <span>Sponsorship: $1.00/mo./Average Daily Population</span>
                          </mat-checkbox>
                        </div>
                      </mat-card>
                    </div>
                  </li>
                </div>
              </div>
            </mat-card>
          </div>
        </div>
        <div class="col-6">
          <div class="row">
            <div class="d-flex justify-content-center align-items-center mt-10;">
              <mat-card>
                <div class="col-12 pt-2">
                  <div>
                    <span class="h5 text-center font-weight-bold">Step 3:</span>&nbsp;
                    <span class="h5 text-center font-weight-bold">Review Plan Details</span>
                  </div>
                  <span class="text-center text-black">Based on the facilities and add ons that you have selected, please
                    review your monthly bill below.</span>
                  <mat-card class="mat-elevation-z10">
                    <div class="d-flex justify-content-between align-items-between">
                      <div>Plan Base Cost:</div>
                      <div>{{planPrice | currency:'USD':'symbol'}}</div>
                    </div>
                    <!-- <div class="d-flex justify-content-between align-items-between">
                      <div>Total inmate access Charges:</div>
                      <div>{{ (averageCount ? averageCount * 0.10 : 0) | currency:'USD':'symbol'}}
                      </div>
                    </div> -->
                    <div class="d-flex justify-content-between align-items-between">
                      <div>Add On charges:</div>
                      <div>{{(addOnsPrice  ? addOnsPrice   : 0 ) | currency:'USD':'symbol'}}
                      </div>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between align-items-between">
                      <div>Total Monthly Charge:</div>
                      <div>
                        <span class="font-weight-bold">Total: </span> {{totalPrice | currency:'USD':'symbol'}}
                      </div>
                    </div>
                  </mat-card>
                </div>
              </mat-card>
            </div>
          </div>
          <div class="row pt-2">
            <div class="col-12 mt-2 px-0">
              <mat-card class="p-4 mt-10">
                <div>
                  <span class="h5 text-center font-weight-bold">Step 4:</span>&nbsp;
                  <span class="h5 text-center font-weight-bold">Add Credit Card Info</span>
                </div>
                <span class="text-center text-black">Please enter your credit card information in the form below. Once everything looks correct, click Pay to complete your setup and
                    start using My Justice Portal!</span>
                <app-stripe class="pt-2" [totalCount]="totalPrice" (onPayEvent)="onPayEvent($event)"
                  [facilitiesList]="facilities"></app-stripe>
                  
              </mat-card>
            </div>
          </div>
        </div>

      </div>
</ng-template>
